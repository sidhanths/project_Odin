<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIDHANTH PRO | CLOUD SYNC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- FIREBASE INTEGRATION -->
    <script type="module">
        // Import specific SDKs using the version you provided (12.6.0)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // --- YOUR CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBX6V9PGXSLQRU0CVV6-QJS4thyzNKxe6E",
            authDomain: "sidhanth-os.firebaseapp.com",
            projectId: "sidhanth-os",
            storageBucket: "sidhanth-os.firebasestorage.app",
            messagingSenderId: "45407383238",
            appId: "1:45407383238:web:c7eb051b157c0beb0ff1c7",
            measurementId: "G-GC76TZDEPW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Expose Firebase functions to Window so Alpine.js can use them
        window.db = db;
        window.doc = doc;
        window.setDoc = setDoc;
        window.onSnapshot = onSnapshot;
        
        console.log("ðŸ”¥ Firebase Initialized: Sidhanth OS Online");
    </script>

    <!-- UI CONFIG -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        bg: '#050505',
                        surface: '#121212',
                        border: '#27272a',
                        primary: '#3b82f6',
                        accent: '#10b981',
                        danger: '#ef4444'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'blink': 'blink 1s step-end infinite',
                    },
                    keyframes: {
                        blink: { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #e4e4e7; }
        .card { background: rgba(18, 18, 18, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .table-row-hover:hover { background-color: rgba(255, 255, 255, 0.03); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 3px; }
        .glitch { position: relative; }
        .glitch::before, .glitch::after { content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8; }
        .glitch::before { color: #f0f; z-index: -1; transform: translate(2px, 0); }
        .glitch::after { color: #0ff; z-index: -2; transform: translate(-2px, 0); }
    </style>
</head>

<body class="min-h-screen font-sans selection:bg-primary selection:text-white" x-data="systemOS()">

    <!-- AUTH SCREEN -->
    <div x-show="!authenticated" class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center font-mono p-4">
        <div class="max-w-md w-full space-y-6">
            <div class="text-accent text-xs mb-4">
                > CONNECTING TO SATELLITE...<br>
                > SYNCING FIRESTORE...<br>
                > ACCESS CONTROL: ACTIVE
            </div>
            <h1 class="text-4xl font-bold text-white glitch" data-text="SIDHANTH.PRO">SIDHANTH.PRO</h1>
            <div class="relative">
                <span class="absolute left-3 top-3 text-gray-500">></span>
                <input 
                    type="password" 
                    x-model="passwordInput" 
                    @keyup.enter="login()"
                    placeholder="ENTER PASSCODE"
                    class="w-full bg-surface border border-border rounded p-3 pl-8 text-white focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent transition-all"
                    autofocus
                >
            </div>
            <button @click="login()" class="w-full bg-white text-black font-bold py-3 hover:bg-gray-200 transition-colors uppercase text-sm tracking-widest">
                Initialize System
            </button>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div x-show="authenticated" x-transition.opacity.duration.1000ms class="p-4 md:p-8 max-w-7xl mx-auto space-y-6">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end border-b border-border pb-6">
            <div>
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-white mb-2">SIDHANTH<span class="text-primary">.PRO</span></h1>
                <p class="text-gray-400 font-mono text-sm">STATUS: <span class="text-accent font-bold">ONLINE (CLOUD SYNC)</span> | <span class="text-xs text-gray-600 cursor-pointer hover:text-white" @click="logout()">[LOGOUT]</span></p>
            </div>
            <div class="mt-4 md:mt-0 text-right">
                <div class="text-3xl font-mono font-bold text-white" x-text="currentTime"></div>
                <div class="text-sm text-gray-500 uppercase tracking-widest" x-text="currentDate"></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- LEFT COL: Schedules (8 cols wide) -->
            <div class="lg:col-span-8 space-y-6">
                
                <div class="flex space-x-4 mb-4">
                    <button @click="setMode('wfh')" :class="mode === 'wfh' ? 'bg-primary text-white' : 'bg-surface text-gray-400 border border-border'" class="px-6 py-2 rounded-lg font-bold text-sm transition-all hover:bg-opacity-90">WFH PROTOCOL (M/W/F)</button>
                    <button @click="setMode('office')" :class="mode === 'office' ? 'bg-primary text-white' : 'bg-surface text-gray-400 border border-border'" class="px-6 py-2 rounded-lg font-bold text-sm transition-all hover:bg-opacity-90">OFFICE PROTOCOL (T/TH)</button>
                </div>

                <!-- Schedule Table -->
                <div class="card rounded-2xl overflow-hidden">
                    <div class="p-6 border-b border-border flex justify-between items-center">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-accent animate-pulse"></span> 
                            Daily Timeline
                        </h2>
                        <span class="text-xs font-mono text-gray-500 border border-border px-2 py-1 rounded">EST TIMEZONE</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-surface text-gray-400 font-mono text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Time</th>
                                    <th class="px-6 py-3">Activity</th>
                                    <th class="px-6 py-3">Directives / Notes</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-border">
                                <template x-for="slot in (mode === 'wfh' ? wfhSchedule : officeSchedule)">
                                    <tr class="table-row-hover transition-colors font-mono">
                                        <td class="px-6 py-4 text-primary font-bold whitespace-nowrap" x-text="slot.time"></td>
                                        <td class="px-6 py-4 font-semibold text-white" x-text="slot.activity"></td>
                                        <td class="px-6 py-4 text-gray-400" x-text="slot.notes"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Nutrition Module -->
                <div class="card rounded-2xl p-6">
                    <h2 class="text-lg font-bold text-white mb-4 border-b border-border pb-2">Fuel Logistics</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                        <div class="space-y-4">
                            <div>
                                <span class="text-xs font-mono text-primary uppercase block mb-1">06:00 AM - Activation</span>
                                <p class="text-gray-300">Shilajit/Lemon Water + Black Coffee <span class="text-xs text-gray-500">(No Food)</span></p>
                            </div>
                            <div>
                                <span class="text-xs font-mono text-primary uppercase block mb-1">Breakfast</span>
                                <p class="text-white font-medium">Overnight Oats + 4 Boiled Egg Whites</p>
                                <p class="text-gray-500 text-xs mt-1">Oats, Chia, Flax, Berries. Pre-made.</p>
                            </div>
                            <div>
                                <span class="text-xs font-mono text-primary uppercase block mb-1">Lunch</span>
                                <p class="text-white font-medium">150g Chicken + Brown Rice + Broccoli</p>
                                <p class="text-gray-500 text-xs mt-1">Dessert: 1 Oikos Yogurt.</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <span class="text-xs font-mono text-primary uppercase block mb-1">Post-Workout</span>
                                <p class="text-white font-medium">50g Whey Isolate Shake</p>
                                <p class="text-gray-500 text-xs mt-1">+ L-Carnitine, Collagen, Creatine.</p>
                            </div>
                            <div>
                                <span class="text-xs font-mono text-primary uppercase block mb-1">Dinner (Light)</span>
                                <p class="text-white font-medium">2 Eggs + Salad OR Dal/Roti</p>
                                <p class="text-gray-500 text-xs mt-1">Keep it light for sleep quality.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COL: Checklists & Stats -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Current Directive -->
                <div class="bg-gradient-to-br from-primary to-blue-700 rounded-2xl p-6 shadow-lg shadow-blue-900/20 text-white relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-blue-200 text-xs font-bold uppercase tracking-widest mb-1">CURRENT DIRECTIVE</p>
                        <h3 class="text-2xl font-bold mb-2" x-text="currentDirective"></h3>
                        <p class="text-sm text-blue-100 opacity-90">Focus. The clock is ticking.</p>
                    </div>
                    <div class="absolute -right-4 -bottom-4 text-9xl opacity-10 font-black">!</div>
                </div>

                <!-- Daily Checklist -->
                <div class="card rounded-2xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-bold text-white">Execution List</h2>
                        <div class="text-xs font-mono text-gray-500" x-text="progress + '% DONE'"></div>
                    </div>

                    <div class="space-y-3">
                        <template x-for="task in tasks" :key="task.id">
                            <div 
                                @click="toggleTask(task.id)"
                                class="cursor-pointer group flex items-center p-3 rounded-lg border transition-all duration-200"
                                :class="task.completed ? 'bg-accent/10 border-accent/20' : 'bg-surface border-border hover:border-gray-600'"
                            >
                                <div class="w-5 h-5 rounded border mr-3 flex items-center justify-center transition-colors"
                                     :class="task.completed ? 'bg-accent border-accent' : 'border-gray-600 group-hover:border-gray-400'">
                                    <svg x-show="task.completed" class="w-3 h-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                                <span :class="task.completed ? 'text-gray-500 line-through' : 'text-gray-200'" class="text-sm font-medium" x-text="task.name"></span>
                            </div>
                        </template>
                    </div>
                    
                    <div class="mt-6 w-full bg-surface rounded-full h-1.5 overflow-hidden">
                        <div class="bg-accent h-1.5 rounded-full transition-all duration-700" :style="'width: ' + progress + '%'"></div>
                    </div>
                </div>

                <!-- Stats / Streaks -->
                <div class="card rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-bold text-white">Performance</h2>
                        <span class="text-xs text-gray-500">LIFETIME</span>
                    </div>
                    <div class="bg-surface rounded-xl p-4 border border-border text-center">
                        <p class="text-gray-500 text-xs uppercase tracking-widest mb-1">Discipline Streak</p>
                        <h2 class="text-4xl font-mono font-bold text-white">
                            DAY <span x-text="streak"></span> <span class="text-orange-500">ðŸ”¥</span>
                        </h2>
                        <p class="text-xs text-gray-600 mt-2">Consecutive days of clean living</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        function systemOS() {
            return {
                // AUTH DATA
                authenticated: sessionStorage.getItem('sidhanth_auth') === 'true',
                passwordInput: '',
                systemPass: 'admin', 

                mode: 'wfh',
                manualOverride: false,
                currentTime: '',
                currentDate: '',
                currentDirective: 'INITIALIZING...',
                
                // DATA (Default fallback)
                streak: 1,
                tasks: [
                    { id: 1, name: 'Wake Up 05:00 AM', completed: false },
                    { id: 2, name: 'CELPIP Study (2+ Hours)', completed: false },
                    { id: 3, name: 'Gym Session', completed: false },
                    { id: 4, name: 'LeetCode (1 Problem)', completed: false },
                    { id: 5, name: 'Clean Diet (100% Adherence)', completed: false },
                    { id: 6, name: 'Clean Living (No Slacking)', completed: false }
                ],
                
                // SCHEDULES
                wfhSchedule: [
                    { time: '05:00 - 05:15', activity: 'Wake Up Protocol', notes: 'Cold Water. No Phone.' },
                    { time: '05:15 - 06:00', activity: 'System Prep', notes: 'Coffee, Plan Day.' },
                    { time: '06:00 - 07:45', activity: 'Deep Work: CELPIP', notes: 'Fresh Brain Block.' },
                    { time: '07:45 - 09:15', activity: 'Physical Training', notes: 'Heavy Weights + Sauna.' },
                    { time: '09:30 - 13:00', activity: 'AI Engineering', notes: 'Deep Focus.' },
                    { time: '13:00 - 13:30', activity: 'Fuel + LeetCode', notes: '1 Problem (30 mins).' },
                    { time: '13:30 - 17:00', activity: 'Engineering Cont.', notes: 'Execution.' },
                    { time: '18:00 - 19:30', activity: 'CELPIP Block 2', notes: 'Speaking/Listening Drills.' },
                    { time: '21:30', activity: 'Sleep Protocol', notes: 'Recovery.' }
                ],
                officeSchedule: [
                    { time: '05:00 - 07:00', activity: 'Deep Work: CELPIP', notes: 'Study before commute.' },
                    { time: '07:15 - 08:00', activity: 'Gym (Speed Run)', notes: 'High Intensity.' },
                    { time: '08:15 - 09:00', activity: 'Commute', notes: 'Audio Learning / Reading.' },
                    { time: '09:00 - 17:00', activity: 'Office Work', notes: 'Lunch: LeetCode.' },
                    { time: '18:00 - 19:30', activity: 'Evening Review', notes: 'Light Study.' },
                    { time: '21:30', activity: 'Sleep Protocol', notes: 'Recovery.' }
                ],

                init() {
                    this.updateTime();
                    setInterval(() => this.updateTime(), 1000);
                    
                    // Wait for window.db to be available then sync
                    setTimeout(() => {
                        this.syncCloud();
                    }, 1500);
                },

                // AUTH FUNCTIONS
                login() {
                    if(this.passwordInput === this.systemPass) {
                        this.authenticated = true;
                        sessionStorage.setItem('sidhanth_auth', 'true');
                        this.syncCloud();
                    }
                },
                logout() {
                    this.authenticated = false;
                    sessionStorage.removeItem('sidhanth_auth');
                    this.passwordInput = '';
                },

                setMode(newMode) {
                    this.mode = newMode;
                    this.manualOverride = true;
                },

                updateTime() {
                    const now = new Date();
                    this.currentTime = now.toLocaleTimeString('en-US', { hour12: false });
                    this.currentDate = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
                    
                    const hour = now.getHours();
                    
                    // Only auto-switch if user hasn't manually clicked a button
                    if (!this.manualOverride) {
                        const day = now.getDay(); 
                        const isOffice = (day === 2 || day === 4); // Tue/Thu
                        
                        if (isOffice && this.mode !== 'office') this.mode = 'office';
                        if (!isOffice && day !== 0 && day !== 6 && this.mode !== 'wfh') this.mode = 'wfh';
                    }

                    // Directives
                    if (hour < 5) this.currentDirective = "SLEEP RECOVERY";
                    else if (hour < 7) this.currentDirective = "DEEP STUDY (CELPIP)";
                    else if (hour < 9) this.currentDirective = (this.mode === 'office') ? "COMMUTE / GYM" : "GYM / SAUNA";
                    else if (hour < 13) this.currentDirective = "WORK (ENGINEERING)";
                    else if (hour < 14) this.currentDirective = "LEETCODE + FUEL";
                    else if (hour < 17) this.currentDirective = "WORK (ENGINEERING)";
                    else if (hour < 20) this.currentDirective = "STUDY / DECOMPRESS";
                    else if (hour < 22) this.currentDirective = "WIND DOWN";
                    else this.currentDirective = "SLEEP RECOVERY";
                },

                get progress() {
                    const done = this.tasks.filter(t => t.completed).length;
                    return Math.round((done / this.tasks.length) * 100);
                },

                async toggleTask(id) {
                    this.tasks = this.tasks.map(t => {
                        if (t.id === id) {
                            const newState = !t.completed;
                            // Small Confetti
                            if(newState) {
                                confetti({
                                    particleCount: 50,
                                    spread: 60,
                                    origin: { y: 0.7 }
                                });
                            }
                            return { ...t, completed: newState };
                        }
                        return t;
                    });
                    
                    // Big Confetti on 100%
                    if (this.progress === 100) {
                        this.triggerBigConfetti();
                    }
                    
                    await this.saveToCloud();
                },

                triggerBigConfetti() {
                    var duration = 3 * 1000;
                    var animationEnd = Date.now() + duration;
                    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
                    function randomInRange(min, max) { return Math.random() * (max - min) + min; }
                    var interval = setInterval(function() {
                      var timeLeft = animationEnd - Date.now();
                      if (timeLeft <= 0) return clearInterval(interval);
                      var particleCount = 50 * (timeLeft / duration);
                      confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                      confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
                    }, 250);
                },

                // --- CLOUD SYNC LOGIC ---
                async syncCloud() {
                    if (!window.db) return;
                    console.log("Starting Sync...");
                    
                    // We use 'users' collection and document 'sidhanth'
                    const docRef = window.doc(window.db, "users", "sidhanth");
                    
                    window.onSnapshot(docRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            console.log("Data fetched:", data);
                            
                            const serverDate = data.lastOpenDate;
                            const today = new Date().toDateString();
                            
                            // Check for New Day Reset
                            if (serverDate !== today) {
                                // It's a new day! Reset and push back to server
                                console.log("New Day Detected. Resetting...");
                                this.tasks = this.tasks.map(t => ({ ...t, completed: false }));
                                if (serverDate) this.streak = (data.streak || 0) + 1;
                                this.saveToCloud(today);
                            } else {
                                // Same day, just load data
                                this.tasks = data.tasks;
                                this.streak = data.streak;
                            }
                        } else {
                            // First time ever: Create the doc
                            console.log("No Data Found. Creating new user profile.");
                            this.saveToCloud();
                        }
                    });
                },

                async saveToCloud(forceDate) {
                    if (!window.db) return;
                    const today = forceDate || new Date().toDateString();
                    await window.setDoc(window.doc(window.db, "users", "sidhanth"), {
                        tasks: this.tasks,
                        streak: this.streak,
                        lastOpenDate: today
                    });
                    console.log("Saved to Cloud.");
                }
            }
        }
    </script>
</body>
</html>